## 概念

Hypertext Transfer Protocol, 超文本传输(转移)协议，是客户端和服务端传输文本制定的协议。构建WWW的具体的三项技术如下：
![HTTP 协议是基于请求与响应](/media/hecc/000277FE000C3C761/项目/php_works/easy-tips/resouse_images/http_protocol_resquest_and_respone.png  "HTTP 协议是基于请求与响应，具体如下图所示")

HTTP 协议主要特点
    
    -- 简单快速：当客户端向服务器端发送请求时，只是简单的填写请求路径和请求方法即可，然后就可以通过浏览器或其他方式将该请求发送就行了
    -- 灵活：HTTP 协议允许客户端和服务器端传输任意类型任意格式的数据对象
    -- 无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接，采用这种方式可以节省传输时间。(当今多数服务器支持Keep-Alive功能，使用服务器支持长连接，解决无连接的问题)
    -- 无状态：无状态是指协议对于事务处理没有记忆能力，服务器不知道客户端是什么状态。即客户端发送HTTP请求后，服务器根据请求，会给我们发送数据，发送完后，不会记录信息。(使用 cookie 机制可以保持 session，解决无状态的问题)


WWW: world wide web, 万维网
    
    - HTML: Hypertext Markup Language, 超文本标记语言
    - HTTP: Hypertext Transfer Protocol, 超文本传输(转移)协议 (HTTP是TCP/IP的应用层协议)
    - URL: Uniform Resource Locator, 统一资源定位符号 

> URI: Uniform Resource Identitier, 统一资源标示符号，URL是URI的子集

## TCP/IP

```
    应用层(http/https/websocket/ftp...) => 定义：文本传输协议
      |
    表示层(Presentation layer) => 定义：数据格式化，代码转换，数据加密
      |
    绘话层(Session layer) => 定义：建立和解除其他点的联系
      |
    传输层(tcp/udp) => 定义：端口
      |
    网络层(ip)　=> 定义：IP
      |
    链路层(mac&数据包) => 定义：数据包，MAC地址
      |
    实体层(光缆/电缆/交换机/路由/终端...) => 定义：物理
```

TCP/IP:

- 解释一：分别代表tcp协议和ip协议
- 解释二：如果按照网络五层架构，TCP/IP代表除了应用层其他层所有协议簇的统称

TCP/IP connect: TCP/IP的三次握手:
```
          标有syn的数据包
          ------------->
          标有syn/ack的数据包
  client  <-------------  server
          标有ack的数据包
          -------------->
```

TCP/IP finish: TCP/IP的四次握手:
```
                          fin
                    <-------------
                          ack
client(或server)    -------------> server(或client)
                          fin
                    ------------->
                          ack
                    <-------------
```

## HTTP 报文

HTTP 报文分为两类:
- 请求报文
- 响应报文

![HTTP 请求报文](/media/hecc/000277FE000C3C761/项目/php_works/easy-tips/resouse_images/request_content.png  "HTTP 请求报文")
![HTTP 响应报文](/media/hecc/000277FE000C3C761/项目/php_works/easy-tips/resouse_images/respone_content.png "HTTP 响应报文")

HTTP 报文由三部分组成:
- Start Line
- Headers
- Entity Body

### 请求报文Start Line

语法 : <方法> <请求URL> < HTTP 协议版本>

    -- GET / HTTP/1.1

#### HTTP Method

    -- get: 获取资源，不携带http body,支持查询参数，大小2KB
    -- post: 传输资源，http body, 大小默认8M，1000个input variable
    -- put: 传输资源，http body，资源更新
    -- delete: 删除资源,不携带http body
    -- patch: 传输资源，http body，存在的资源局部更新
    -- head: 获取http header,不携带http body
    -- options: 获取支持的method,不携带http body
    -- trace: 追踪，返回请求回环信息,不携带http body
    -- connect: 建立隧道通信

### 响应报文Start Line

语法 : <HTTP-Version> <Status-Code> <Reason-Phrase> <CRLF>

    --　HTTP-Version - HTTP 协议版本
    -- Status-Code - 状态码
    -- Reason-Phrase - 状态码描述
    -- CRLF - 回车/换行符 最后一个响应头之后是一个空行，发送回车符和换行符，通知浏览器以下不再有响应头

#### HTTP Status Code
    -- 1xx：指示信息 – 表示请求已接收，继续处理
    -- 2xx：成功 – 表示请求已被成功接收
    -- 3xx：重定向 – 要完成请求必须进行更进一步的操作
    -- 4xx：客户端错误 – 请求有语法错误或请求无法实现
    -- 5xx：服务器错误 – 服务器未能实现合法的请求

#### 常见状态码
    -- 200: ok
    -- 301: 永久重定向 
    -- 302: 临时重定向 
    -- 303: 临时重定向，要求用get请求资源
    -- 304: not modified, 返回缓存，和重定向无关
    -- 307: 临时重定向,严格不从post到get
    -- 400: 参数错误
    -- 401: 未通过http认证
    -- 403: forbidden，未授权
    -- 404: not found，不存在资源
    -- 500: internet server error，代码错误
    -- 502: bad gateway，fastcgi返回的内容web server不明白
    -- 503: service unavailable，服务不可用　请求未完成，服务器临时过载或当机
    -- 504: gateway timeout，fastcgi响应超时

### HTTP Header Fields

常见通用头部

    -- Cache-Control:
  - no-cache: 不缓存过期的缓存
  - no-store: 不缓存
    -- Pragma: no-cache, 不使用缓存，http1.1前的历史字段
    -- Connection: 
  - 控制不在转发给代理首部不字段
  - Keep-Alive/Close: 持久连接
    -- Date: 创建http报文的日期 

常见请求头

    -- Accept: 可以处理的媒体类型和优先级 
    -- Host: 目标主机域名
    -- Referer: 请求从哪发起的原始资源URI
    -- User-Agent: 创建请求的用户代理名称
    -- Cookie: cookie信息  

常见响应头

    -- Location: 重定向地址
    -- Server: 被请求的服务web server的信息
    -- Set-Cookie: 要设置的cookie信息
  - NAME: 要设置的键值对
  - expires: cookie过期时间
  - path: 指定发送cookie的目录
  - domain: 指定发送cookie的域名
  - Secure: 指定之后只有https下才发送cookie
  - HostOnly: 指定之后javascript无法读取cookie

Keep-Alive

    -- Keep-Alive: 
    -- HTTP协议初期每次连接结束后都会断开TCP连接，之后HEADER的connection字段定义Keep-Alive（HTTP 1.1 默认　持久连接），代表如果连接双方如果没有一方主动断开都不会断开TCP连接，减少了每次建立HTTP连接时进行TCP连接的消耗。

## Cookie/Session

    -- Cookie: 工作机制是用户识别和状态管理，服务端为了管理用户的状态会通过客户端，把一些临时的数据写入到设备中Set-Cookie，当用户访问服务的时候，服务可以通过通信的方式取回之前存放的cookie。
    -- Session:　由于http是无状态的，请求之间无法维系上下文，所以就出现了session作为会话控制，服务端存放用户的会话信息。

## HTTPs

概念:在http协议上增加了ssl(secure socket layer)层。

```
    SSL层
      |
    应用层
      |
    传输层
      |
    网络层
      |
    链路层
      |
    实体层
```

HTTPS 认证流程
```

                              发起请求
                     --------------------------->　　server 
                              下发证书
                      <---------------------------   server 
                      证书数字签名(用证书机构公钥加密)
                     --------------------------->　　证书机构 
                          证书数字签名验证通过
client(内置证书机构证书) <---------------------------   证书机构
                      公钥加密随机密码串(未来的共享秘钥)
                     --------------------------->　　server私钥解密(非对称加密)
                        SSL协议结束　HTTP协议开始
                      <---------------------------   server(对称加密)
                            共享秘钥加密 HTTP
                     --------------------------->　　server(对称加密)
```

+ 核对证书证书： 证书机构的公开秘钥验证证书的数字签名
+ 公开密钥加密建立连接：非对称加密
+ 共享密钥加密

## Websocket

+ 基于http协议建立连接，header的upgrade字段转化协议为websocket
+ 全双工通信，客户端建立连接

## HTTP2

+ 多路复用：多个请求共享一个tcp连接
+ 全双工通信
+ 必须https://
+ 头部压缩
+ 二进制传输

#########

https://segmentfault.com/a/1190000008900299
https://segmentfault.com/l/1500000010875198
